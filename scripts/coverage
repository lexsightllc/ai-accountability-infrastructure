#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
# shellcheck source=scripts/lib/common.sh
source "${SCRIPT_DIR}/lib/common.sh"

ensure_venv

THRESHOLD="${COVERAGE_THRESHOLD:-80}"
PYTEST_CMD=(pytest --cov=ai_trust --cov-report=term-missing --cov-report=xml --cov-report=html --cov-fail-under="${THRESHOLD}")
if [[ -n "${PYTEST_COV_ARGS:-}" ]]; then
  # shellcheck disable=SC2206
  PYTEST_CMD+=(${PYTEST_COV_ARGS})
fi
PYTEST_CMD+=("$@")

run_cmd "${PYTEST_CMD[@]}"
_log "Coverage reports written to coverage.xml and htmlcov/"
